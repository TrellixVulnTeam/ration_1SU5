{% extends "base.html" %}
{% load staticfiles %}

{% load humanize %}


{% block content %}

{% include 'ajax/rating_star.html' %}
{% include 'ajax/interest_flame.html' %}


<div class="mt-3 pb-2 container">

    <div class="row">

        <!-- Middle container -->
        <div class="col-9 ">
            <div class="container bg-white">

                <div class="row">

                    <div class="col-3 mt-3">

                        <!-- Image -->
                        {% ifequal item.image '' %}
                        <img width="175" height="175" src="/media/item_icons/default.png"/>
                        {% else %}
                        <img width="175" height="175px" src="/media/{{ item.image }}"/>
                        {% endifequal %}

                    </div>

                    <div class="col-9 mt-3">

                        <div class="row">

                            <div class="col-11">

                                <!-- Creator and timestamp -->
                                <p class="mb-1">
                                    <a href="{% url 'user' item.creator.username %}">@{{ item.creator.username }}</a>
                                    <small class="text-muted"> â€¢ {{item.created_at|naturaltime}}</small>
                                </p>

                                <!-- Item name -->
                                <h3 class="mb-1">
                                    {{ item.name }}
                                    {% if item.url %}
                                    <a href="{{ item.url }}" target="_blank"><i
                                            class="material-icons">link</i></a>
                                    {% endif %}
                                </h3>

                                <!-- Tag -->
                                {% for tag in item.tags.all %}
                                <a class="no-underline" href="{% url 'items' %}?tag={{ tag.name }}">
                                <span class="badge badge-light font-weight-normal">
                                    #{{ tag.name }}
                                </span>
                                </a>
                                {% endfor %}


                            </div>

                            <div class="col-1">

                                <!-- Edit and delete -->
                                {% if request.user == item.creator %}
                                <a class="dropdown-toggle " href="#" id="navbardrop"
                                   data-toggle="dropdown">
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="{% url 'edit_item' item.id %}">Edit item</a>
                                    <a class="dropdown-item" href="{% url 'delete_item' item.id %}">Delete item</a>

                                </div>
                                {% endif %}

                            </div>

                            <!-- Rating section -->
                            <div class="container mt-2">
                                <div class="row">

                                    <!-- Site rating -->
                                    <div class="col-4 align-self-center">
                                        {% ifnotequal item.avg_rating None %}
                                        <p class="text-center">
                                            <b>RATION</b>
                                            <br>
                                            {{ item.avg_rating|floatformat }}/5
                                        </p>
                                        {% endifnotequal %}
                                    </div>
                                    {% if request.user.is_authenticated %}
                                    <div class="col-8">
                                        <form class="rating-form"
                                              method="POST">


                                            <div class="row">
                                                <div class="col-6 align-self-center">
                                                    <p class="text-center">
                                                        <b>YOUR RATING</b>
                                                        <br>
                                                        <input type="number"
                                                               class="your-rating" min="1"
                                                               max="5"
                                                               name="rating"
                                                               value="{{user_item.rating|floatformat|default_if_none:''}}"/>
                                                        / 5
                                                    </p>
                                                </div>
                                                <div class="col-6 align-self-center">
                                                    <p class="text-center">
                                                        <b>YOUR INTEREST</b>
                                                        <br>
                                                        <input type="number"
                                                               class="your-interest"
                                                               name="interest"
                                                               max="3"
                                                               min="1"
                                                               value="{{ user_item.interest|floatformat}}"/>
                                                        / 3
                                                    </p>
                                                </div>
                                            </div>
                                            <button type="submit" hidden/>

                                        </form>

                                    </div>

                                    {% endif %}

                                    <!-- Rating Stars Box -->
                                    <div class='rating-stars text-center'>
                                        <ul id='stars'>
                                            <li class='star
{% if user_item.rating >= 1 %}
selected
{% endif %}' title='Horrible' data-value='1'>
                                                <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star
{% if user_item.rating >= 2 %}
selected
{% endif %}
' title='Bad' data-value='2'>
                                                <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star
{% if user_item.rating >= 3 %}
selected
{% endif %}' title='Normal' data-value='3'>
                                                <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star
{% if user_item.rating >= 4 %}
selected
{% endif %}' title='Good' data-value='4'>
                                                <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star
{% if user_item.rating >= 5 %}
selected
{% endif %}' title='Excellent' data-value='5'>
                                                <i class='fa fa-star fa-fw'></i>
                                            </li>
                                        </ul>
                                    </div>


                                    <div class='success-box'>
                                        <div class='text-message'></div>
                                    </div>

                                    <!-- Interest flames -->
                                    <div class="interest-flames text-center">
                                        <ul id="flames">
                                            <li class="flame
{% if user_item.interest >= 1 %}
selected
{% endif %}"
                                                title="Not interested" data-value="1">
                                                <i class="fas fa-fire"></i>
                                            </li>
                                            <li class="flame
{% if user_item.interest >= 2 %}
selected
{% endif %}"
                                                title="Interested" data-value="2">
                                                <i class="fas fa-fire"></i>
                                            </li>
                                            <li class="flame
{% if user_item.interest >= 3 %}
selected
{% endif %}"
                                                title="Very interested" data-value="3">
                                                <i class="fas fa-fire"></i>
                                            </li>
                                        </ul>

                                    </div>

                                </div>
                            </div>


                        </div>

                    </div>

                    <div class="container pt-3 pb-3">
                        <p class="text-justify">{{ item.description }}</p>
                    </div>

                </div>


            </div>

        </div>

        <!-- Right container -->
        <div class="col-3 bg-white">
            {% include 'includes/right_container.html' %}
        </div>

    </div>


</div>

{% endblock %}
