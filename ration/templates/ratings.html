{% extends "base.html" %}


{% block content %}


<div class="mt-3 pb-2 container">

    <div class="row">

        {% include 'includes/left_container.html' %}

        <!-- Middle container -->
        <div class="col-7">

            <div class="row no-gutters">
                <div class="col-9">
                    <h3 class="font-weight-bold d-inline">
                        #{{ request.GET.tag }}
                    </h3>
                    路
                    <a href="{% url 'user' user.username %}?tag={{ request.GET.tag }}">
                        View timeline
                    </a>

                    <!-- Follow/unfollow -->
                    {% if request.user == True and request.user != user_tag.user %}
                    {% if user_tag %}
                    路
                    <a href="{% url 'follow' user_tag.id %}">
                        {% if is_following %}
                        Unfollow
                        {% else %}
                        Follow
                        {% endif %}
                    </a>
                    {% endif %}
                    {% endif %}

                    <!-- Favorite/unfavorite button -->
                    {% if request.user.is_authenticated %}
                    {% if user_tag %}
                    路
                    <a href="{% url 'favorite_user_tag' user_tag.id %}">
                        {% if is_favorite %}
                        Unfavorite
                        {% else %}
                        Favorite
                        {% endif %}
                    </a>
                    {% endif %}
                    {% endif %}

                    <!-- Compare ratings -->
                    {% if request.user.is_authenticated == True and request.user != user %}
                    路
                    <a href="{% url 'compare_items' user.username %}">compare your ratings</a>
                    {% endif %}

                </div>
                <div class="col-3">
                    {% if user_tag %}
                    <div class="float-right">
                        {% ifequal request.user user %}
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            {% if user_tag.is_private %}
                            Private
                            {% else %}
                            Public
                            {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="{% url 'private_user_tag' user_tag.id %}">
                                {% if user_tag.is_private %}
                                Public
                                {% else %}
                                Private
                                {% endif %}
                            </a>
                        </div>
                        {% endifequal %}
                    </div>
                    {% endif %}
                </div>
            </div>


            <table class="table table-bordered bg-white">
                <tr class="thead-dark">
                    <th class="align-middle text-center">#</th>
                    <th class="align-middle">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=name&tag={{ request.GET.tag }}">
                            Name
                        </a>
                    </th>
                    <th class="align-middle text-center">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=ration&sort=desc&tag={{ request.GET.tag }}">
                            Ration
                        </a>
                    </th>
                    <th class="align-middle text-center">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=score&sort=desc&tag={{ request.GET.tag }}">
                            Sco
                        </a>
                    </th>
                    <th class="align-middle text-center">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=interest&sort=desc&tag={{ request.GET.tag }}">
                            Int
                        </a>
                    </th>
                </tr>

                {% for user_item in rating_list %}
                <tr class="">
                    <td class="align-middle text-center">
                        {{ forloop.counter }}
                    </td>

                    <!-- Item name -->
                    <td>
                        <a href="{% url 'item' user_item.item.id %}">{{ user_item.item.name }}</a>
                        {% if user_item.item.url %}
                        <a href="{{ user_item.item.url }}" target="_blank"><i
                                class="material-icons">link</i></a>
                        {% endif %}
                    </td>

                    <!-- Ration score -->
                    <td class="align-middle text-center">
                        {% if user_item.item.avg_rating >= 4 %}
                        <b>{{ user_item.item.avg_rating|floatformat }}</b>
                        {% else %}
                        {{ user_item.item.avg_rating|floatformat }}
                        {% endif %}
                    </td>

                    <!-- User score -->
                    <td class="text-center align-middle">
                        {% if user_item.rating >= 4 %}
                        <b> {{ user_item.rating|floatformat }}</b>
                        {% else %}
                        {{ user_item.rating|floatformat }}
                        {% endif %}
                    </td>

                    <!-- User interest -->
                    <td class="text-center align-middle">
                        {% if user_item.interest == 3 %}
                        <b> {{user_item.interest|floatformat}}</b>
                        {% else %}
                        {{user_item.interest|floatformat}}
                        {% endif %}
                    </td>


                </tr>
                {% endfor %}
            </table>


        </div>

        <!-- Right container -->
        <div class="col-3 bg-white shadow-sm">
            {% include 'includes/right_container.html' %}
        </div>

    </div>


</div>

{% endblock %}
