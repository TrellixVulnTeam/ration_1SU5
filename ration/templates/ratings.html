{% extends "base.html" %}
{% load utils %}

{% block content %}

{% include 'js/rating_star.html' %}
{% include 'js/interest_flame.html' %}


<div class="mt-3 pb-2 container">

    <div class="row">

        {% include 'includes/left_container.html' %}

        <!-- Middle container -->
        <div class="col-10">

            <div class="row no-gutters">
                <div class="col-9">
                    <h3 class="font-weight-bold d-inline">
                        #{{ request.GET.tag }}
                    </h3>
                    路
                    <a href="{% url 'user' user.username %}?tag={{ request.GET.tag }}">
                        View timeline
                    </a>

                    <!-- Follow/unfollow -->
                    {% get_user_tag user request.GET.tag as user_tag %}
                    {% if request.user.is_authenticated == True and request.user != user_tag.user %}
                    {% if user_tag %}
                    路
                    <a href="{% url 'follow' user_tag.id %}">
                        {% user_is_following_user_tag request.user user_tag as is_following %}
                        {% if is_following %}
                        Unfollow
                        {% else %}
                        Follow
                        {% endif %}
                    </a>
                    {% endif %}
                    {% endif %}

                    <!-- Favorite/unfavorite button -->
                    {% if request.user.is_authenticated %}
                    {% if user_tag %}
                    路
                    <a href="{% url 'favorite_user_tag' user_tag.id %}">
                        {% if is_favorite %}
                        Unfavorite
                        {% else %}
                        Favorite
                        {% endif %}
                    </a>
                    {% endif %}
                    {% endif %}

                    <!-- Compare ratings -->
                    {% if request.user.is_authenticated == True and request.user != user %}
                    路
                    <a href="{% url 'compare_items' user.username %}">compare your ratings</a>
                    {% endif %}

                </div>
                <div class="col-3">
                    {% if user_tag %}
                    <div class="float-right">
                        {% ifequal request.user user %}
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            {% if user_tag.is_private %}
                            Private
                            {% else %}
                            Public
                            {% endif %}
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="{% url 'private_user_tag' user_tag.id %}">
                                {% if user_tag.is_private %}
                                Public
                                {% else %}
                                Private
                                {% endif %}
                            </a>
                        </div>
                        {% endifequal %}
                    </div>
                    {% endif %}
                </div>
            </div>


            {% if rating_list %}
            <table class="table table-bordered bg-white">
                <tr class="thead-dark">
                    <th class="align-middle text-center">#</th>
                    <th class="align-middle">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=name&sort=asc&tag={{ request.GET.tag }}">
                            Name
                        </a>
                    </th>
                    <th class="align-middle text-center">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=ration&sort=desc&tag={{ request.GET.tag }}">
                            Ration
                        </a>
                    </th>
                    <th class="align-middle text-center">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=score&sort=desc&tag={{ request.GET.tag }}">
                            Sco
                        </a>
                    </th>
                    <th class="align-middle text-center">
                        <a class="text-white "
                           href="{% url 'rating_list' user.username %}?order=interest&sort=desc&tag={{ request.GET.tag }}">
                            Int
                        </a>
                    </th>
                </tr>

                {% for user_item in rating_list %}
                <tr class="">
                    <td class="align-middle text-center">
                        {{ forloop.counter }}
                    </td>

                    <!-- Item name -->
                    <td>
                        <a href="{% url 'item' user_item.item.id %}">{{ user_item.item.name }}</a>
                        {% if user_item.item.url %}
                        <a href="{{ user_item.item.url }}" target="_blank"><i
                                class="material-icons">link</i></a>
                        {% endif %}
                    </td>

                    <!-- Ration score -->
                    <td class="align-middle text-center">
                        {% if user_item.item.avg_rating >= 4 %}
                        <b>{{ user_item.item.avg_rating|floatformat }}</b>
                        {% else %}
                        {{ user_item.item.avg_rating|floatformat }}
                        {% endif %}


                    </td>

                    <!-- User score -->
                    <td class="text-center align-middle">


                        <div class="rating-stars text-center">
                            <ul class="stars mb-0" data-value="{{ user_item.item.id}}">

                                {%get_user_score_by_item request.user user_item.item as your_score%}

                                <li class="star {% if your_score >= 1 %}selected{% endif %}"
                                    title="Horrible" data-value="1">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 2 %}selected{% endif %}"
                                    title="Bad" data-value="2">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 3 %}selected{% endif %}"
                                    title="Normal" data-value="3">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 4 %}selected{% endif %}"
                                    title="Good" data-value="4">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 5 %}selected{% endif %}"
                                    title="Excellent" data-value="5">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                            </ul>
                        </div>

                    </td>

                    <!-- User interest -->
                    <td class="text-center align-middle">

                        <div class="interest-flames text-center">
                            <ul class="flames mb-0" data-value="{{ user_item.item.id }}">
                                <li class="flame {% if user_item.interest >= 1 %}selected{% endif %}"
                                    title="Not interested" data-value="1">
                                    <i class="fas fa-fire"></i>
                                </li>
                                <li class="flame {% if user_item.interest >= 2 %}selected{% endif %}"
                                    title="Interested" data-value="2">
                                    <i class="fas fa-fire"></i>
                                </li>
                                <li class="flame {% if user_item.interest >= 3 %}selected{% endif %}"
                                    title="Very interested!" data-value="3">
                                    <i class="fas fa-fire"></i>
                                </li>
                            </ul>
                        </div>

                    </td>


                </tr>
                {% endfor %}
            </table>
            {% endif %}

            {% if comparisons %}
            <table class="table table-bordered bg-white">
                <tr class="thead-dark">
                    <th>#</th>
                    <th style="width: 30%">Item name</th>
                    <th>Score 1</th>
                    <th>Int 1</th>
                    <th>Score 2</th>
                    <th>Int 2</th>
                    <th>Diff sco</th>
                    <th>Avg sco</th>
                    <th>Avg int</th>
                </tr>
                {% for comparison in comparisons %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td><a href="{% url 'item' comparison.item.id %}">{{ comparison.item.name }}</a></td>
                    <td>{{ comparison.rating1 }}</td>
                    <td>{{ comparison.interest1 }}</td>
                    <td>
                        <div class="rating-stars text-center">
                            <ul class="stars mb-0" data-value="{{ comparison.item.id}}">

                                {%get_user_score_by_item request.user comparison.item as your_score%}

                                <li class="star {% if your_score >= 1 %}selected{% endif %}"
                                    title="Horrible" data-value="1">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 2 %}selected{% endif %}"
                                    title="Bad" data-value="2">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 3 %}selected{% endif %}"
                                    title="Normal" data-value="3">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 4 %}selected{% endif %}"
                                    title="Good" data-value="4">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                                <li class="star {% if your_score >= 5 %}selected{% endif %}"
                                    title="Excellent" data-value="5">
                                    <i class='fa fa-star fa-fw'></i>
                                </li>
                            </ul>
                        </div>
                    </td>
                    <td>
                        <div class="interest-flames text-center">
                            <ul class="flames mb-0" data-value="{{ comparison.item.id }}">
                                <li class="flame {% if comparison.interest2 >= 1 %}selected{% endif %}"
                                    title="Not interested" data-value="1">
                                    <i class="fas fa-fire"></i>
                                </li>
                                <li class="flame {% if comparison.interest2 >= 2 %}selected{% endif %}"
                                    title="Interested" data-value="2">
                                    <i class="fas fa-fire"></i>
                                </li>
                                <li class="flame {% if comparison.interest2 >= 3 %}selected{% endif %}"
                                    title="Very interested!" data-value="3">
                                    <i class="fas fa-fire"></i>
                                </li>
                            </ul>
                        </div>
                    </td>
                    <td>{{ comparison.rating_difference }}</td>
                    <td>{{ comparison.avg_rating }}</td>
                    <td>{{ comparison.avg_interest }}</td>
                </tr>
                {% endfor %}
            </table>
            {% endif %}


        </div>


    </div>


</div>

{% endblock %}
